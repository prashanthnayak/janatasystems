<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend API Connection</title>
    <script src="config.js"></script>
</head>
<body>
    <h1>üß™ Frontend API Connection Test</h1>
    
    <div style="margin: 20px;">
        <h2>Configuration Test</h2>
        <button onclick="testConfig()">Test Config Initialization</button>
        <div id="configResult"></div>
    </div>
    
    <div style="margin: 20px;">
        <h2>API Connection Test</h2>
        <button onclick="testApiConnection()">Test API Connection</button>
        <div id="apiResult"></div>
    </div>
    
    <div style="margin: 20px;">
        <h2>Scraping Test</h2>
        <input type="text" id="cnrInput" placeholder="Enter CNR Number" value="KAUP050003552024">
        <button onclick="testScraping()">Test Scraping API</button>
        <div id="scrapingResult"></div>
    </div>
    
    <div style="margin: 20px;">
        <h2>Console Output</h2>
        <div id="console" style="background: #f0f0f0; padding: 10px; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        // Capture console output
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        function addToConsole(message, type = 'log') {
            const consoleDiv = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            consoleDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        async function testConfig() {
            const resultDiv = document.getElementById('configResult');
            resultDiv.innerHTML = '<p>üîÑ Testing config initialization...</p>';
            
            try {
                console.log('üß™ Testing config initialization...');
                
                if (!config.initialized) {
                    await config.init();
                }
                
                const apiUrl = config.getApiUrl('/server-info');
                const webUrl = config.getWebUrl('/test');
                
                resultDiv.innerHTML = `
                    <p>‚úÖ Config initialized successfully!</p>
                    <p><strong>API Host:</strong> ${config.API_HOST}</p>
                    <p><strong>API Port:</strong> ${config.API_PORT}</p>
                    <p><strong>Web Port:</strong> ${config.WEB_PORT}</p>
                    <p><strong>Sample API URL:</strong> ${apiUrl}</p>
                    <p><strong>Sample Web URL:</strong> ${webUrl}</p>
                `;
                
            } catch (error) {
                console.error('Config test failed:', error);
                resultDiv.innerHTML = `<p>‚ùå Config test failed: ${error.message}</p>`;
            }
        }

        async function testApiConnection() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<p>üîÑ Testing API connection...</p>';
            
            try {
                console.log('üß™ Testing API connection...');
                
                if (!config.initialized) {
                    await config.init();
                }
                
                const apiUrl = config.getApiUrl('/server-info');
                console.log('Testing API URL:', apiUrl);
                
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <p>‚úÖ API connection successful!</p>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong> <pre>${JSON.stringify(data, null, 2)}</pre></p>
                `;
                
            } catch (error) {
                console.error('API connection test failed:', error);
                resultDiv.innerHTML = `<p>‚ùå API connection failed: ${error.message}</p>`;
            }
        }

        async function testScraping() {
            const resultDiv = document.getElementById('scrapingResult');
            const cnrNumber = document.getElementById('cnrInput').value.trim();
            
            if (!cnrNumber) {
                resultDiv.innerHTML = '<p>‚ùå Please enter a CNR number</p>';
                return;
            }
            
            resultDiv.innerHTML = '<p>üîÑ Testing scraping API...</p>';
            
            try {
                console.log('üß™ Testing scraping API with CNR:', cnrNumber);
                
                if (!config.initialized) {
                    await config.init();
                }
                
                const apiUrl = config.getApiUrl('/scraping/trigger/' + cnrNumber);
                console.log('Testing scraping URL:', apiUrl);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <p>‚úÖ Scraping API call successful!</p>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>CNR:</strong> ${cnrNumber}</p>
                    <p><strong>Response:</strong> <pre>${JSON.stringify(data, null, 2)}</pre></p>
                `;
                
            } catch (error) {
                console.error('Scraping test failed:', error);
                resultDiv.innerHTML = `<p>‚ùå Scraping test failed: ${error.message}</p>`;
            }
        }

        // Auto-initialize config when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üîÑ Page loaded, initializing config...');
            try {
                await config.init();
                console.log('‚úÖ Config initialized on page load');
            } catch (error) {
                console.error('‚ùå Config initialization failed:', error);
            }
        });
    </script>
</body>
</html>
